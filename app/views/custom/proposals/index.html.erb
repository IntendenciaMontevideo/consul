<% provide :title do %><%= t('proposals.index.title') %><% end %>
<% content_for :social_media_meta_tags do %>
  <% render "/shared/social_media_meta_tags", social_title: t("proposals.index.title"), social_description: t("proposals.banner-text")  %>
<% end %>

<% content_for :header_addon do %>
  <div class="show-for-large-only large-search-bar-container">
    <%= render "shared/search_form",
             search_path: proposals_path(page: 1),
             i18n_namespace: "proposals.index.search_form" %>
  </div>
<% end %>
<% content_for :canonical do %>
  <%= render "shared/canonical", href: proposals_url %>
<% end %>
<%= render "/shared/registration_modal" %>
<% if ((current_user.blank?) || (!current_user.blank? && session[current_user.id.to_s].blank?)) %>
  <div class="row-for-banners">
    <div class="box banner-box">
      <%= image_tag(image_path_for('banner-proposals.png'), class: 'banner-image float-center margin-bottom banner-img', width: '100%', alt: t("layouts.header.logo")) %>
      <div class="box-text proposals-box-text">
        <div class="row">
          <h2 class="banner-title proposals-banner-title column small-12 inline-h-0" style="text-align: left;">Ideas</h2>
        </div>
      </div>
    </div>
  </div>
  <div class="row margin-bottom">
    <div class="hide-for-large-only small-search column search-column">
      <%= render "shared/search_form",
              search_path: proposals_path(page: 1),
              i18n_namespace: "proposals.index.search_form" %>
    </div>
  </div>
<% end %>

<main>
  <% if @search_terms || @advanced_search_terms || @tag_filter || params[:retired].present? %>
    <div class="highlight no-margin-top padding margin-bottom">
      <div class="row">
        <div class="small-12 column">
          <% if @search_terms || @advanced_search_terms %>
            <h2><%= t("shared.search_results") %></h2>
            <p>
              <%= page_entries_info @proposals %>
              <% if !@advanced_search_terms %>
                <%= t("proposals.index.search_results_html", count: @proposals.size, search_term: @search_terms) %>
              <% end %>
            <p>
          <% elsif @tag_filter %>
            <h2><%= t("shared.search_results") %></h2>
            <p>
              <%= page_entries_info @proposals %>
              <%= t("proposals.index.filter_topic", count: @proposals.size, topic: @tag_filter) %>
            </p>
          <% elsif params[:retired].present? %>
            <h2><%= t("proposals.index.retired_proposals") %></h2>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>

  <% if ((current_user.blank?) || (!current_user.blank? && session[current_user.id.to_s].blank?)) %>
    <div class="row">
  <% else %>
    <div class="row padding-btn-banner-vote">
  <% end %>
    <div id="proposals" class="proposals-list small-12 medium-9 column">
      
      <% if @proposals.any? %>
        <div class="show-for-small-only">
          <% if Proposal.can_create? %>
            <%= link_to t("proposals.index.start_proposal"),
                    new_proposal_guide,
                    class: 'button expanded green-regular' %>
          <% end %>
          <%= link_to '¿Cómo funcionan las ideas?',
                  '/como-funcionan-las-ideas',
                  class: 'button expanded green-inverted' %>
        </div>
      <% end %>
      
      <% if @featured_proposals.present? %>
        <div class="small-12 column featured-title-proposal">
          <h2>
            <%= t("proposals.index.featured_proposals") %>
          </h2>
        </div>
        <div id="featured-proposals" class="row featured-proposals">
          <% @featured_proposals.each do |featured_proposal| %>
            <%= render "featured_proposal", proposal: featured_proposal %>
          <% end %>
        </div>
      <% end %>

      <%= render("shared/advanced_search", search_path: proposals_path(page: 1)) unless params[:retired].present? %>

      <%= render 'shared/order_links', i18n_namespace: "proposals.index" %>
      <div id="proposals-list">
        <% if @proposals.any? || current_user.blank? %>
          <%= render partial: 'proposals/proposal', collection: @proposals %>
        <% else %>
          <%= empty_recommended_proposals_message_text(current_user) %>
        <% end %>
        <%= paginate @proposals %>
      </div>
    </div>

    <div class="small-12 medium-3 column">
      <aside class="margin-bottom">
        <div class="proposal-icon-text-container margin-bottom margin-top hide-for-small-only">
          <%= image_tag(image_path_for('bulb.png'), class:"proposals-icon", alt: "ideas") %>
          <div class="proposals-text"><h3 class="proposals-header">IDEAS</h3></div>
        </div>
        <div class="margin-top">
          <% if Proposal.can_create? %>
            <%= link_to t("proposals.index.start_proposal"),
                      new_proposal_guide,
                      class: 'button expanded green-regular' %>
          <% end %>
          <%= link_to '¿Cómo funcionan las ideas?',
                      '/como-funcionan-las-ideas',
                      class: 'button expanded green-inverted' %>
        </div>
        <% if params[:retired].blank? %>
          <%= render 'categories' %>
          <%= render "shared/tag_cloud", taggable: 'proposal' %>
          <%= render 'proposals_help' %>
        <% end %>
      </aside>
    </div>

  </div>
</main>
